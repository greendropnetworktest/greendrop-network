<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reset Password | Greendrop Network</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body class="bg-slate-900 text-white min-h-screen flex items-center justify-center font-sans px-6">

  <div class="fixed inset-0 bg-gradient-to-br from-slate-900 via-slate-900 to-green-950 -z-10"></div>

  <div class="w-full max-w-md bg-white/5 border border-white/10 backdrop-blur-xl rounded-3xl p-8 shadow-2xl">
    
    <div class="flex flex-col items-center mb-8">
      <img src="/assets/iconfoto222.png" alt="Logo" class="w-16 h-16 rounded-2xl border border-white/10 mb-4 shadow-lg">
      <h1 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-500">
        New Password
      </h1>
      <p class="text-gray-400 mt-2 text-sm">Please enter a secure password for your account.</p>
    </div>

    <div class="space-y-4">
      <div class="relative">
        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">
          <i class="fa-solid fa-lock"></i>
        </span>
        <input
          type="password"
          id="password"
          placeholder="New password (min. 6 chars)"
          class="w-full bg-white/5 border border-white/10 rounded-xl py-4 pl-12 pr-4 outline-none focus:border-green-500/50 focus:ring-1 focus:ring-green-500/50 transition-all"
        />
      </div>

      <button id="submitBtn" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-slate-900 font-bold py-4 rounded-xl shadow-lg shadow-green-500/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed">
        Update Password
      </button>

      <div id="message" class="text-center text-sm font-medium h-6"></div>
    </div>
  </div>

<script>
  const API_URL = "https://greendrop-api.onrender.com/auth/reset-password";
  const params = new URLSearchParams(window.location.search);
  const token = params.get("token");

  const btn = document.getElementById("submitBtn");
  const msg = document.getElementById("message");
  const passInput = document.getElementById("password");

  if (!token) {
    msg.textContent = "Invalid or missing link.";
    msg.className = "text-red-400";
    btn.disabled = true;
  }

  btn.addEventListener("click", async () => {
    const password = passInput.value;

    if (!password || password.length < 6) {
      msg.textContent = "Minimum 6 characters required.";
      msg.className = "text-red-400";
      return;
    }

    btn.disabled = true;
    btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin mr-2"></i> Submitting...';

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token, password })
      });

      const data = await res.json();

      if (!data.success) {
        throw new Error(data.msg || "An error occurred.");
      }

      msg.textContent = "Updated! You can return to the app.";
      msg.className = "text-green-400";
      btn.classList.add("hidden");
      passInput.classList.add("hidden");

    } catch (err) {
      msg.textContent = err.message;
      msg.className = "text-red-400";
      btn.disabled = false;
      btn.textContent = "Update Password";
    }
  });
</script>

</body>
</html>